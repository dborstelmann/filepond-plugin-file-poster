/*!
 * FilePondPluginFilePoster 2.0.2
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

const e={type:"spring",stiffness:.5,damping:.45,mass:10},t=(e,t,a=1,o=(e=>-.5*(Math.cos(Math.PI*e)-1)),i=10,r=0)=>{const n=1-r,c=t.join(",");for(let t=0;t<=i;t++){const s=t/i,l=r+n*s;e.addColorStop(l,`rgba(${c}, ${o(s)*a})`)}},a=e=>{const t=Math.min(10/e.width,10/e.height),a=document.createElement("canvas"),i=a.getContext("2d"),r=a.width=Math.ceil(e.width*t),n=a.height=Math.ceil(e.height*t);i.drawImage(e,0,0,r,n);let c=null;try{c=i.getImageData(0,0,r,n).data}catch(e){return null}const s=c.length;let l=0,d=0,E=0,p=0;for(;p<s;p+=4)l+=c[p]*c[p],d+=c[p+1]*c[p+1],E+=c[p+2]*c[p+2];return{r:l=o(l,s),g:d=o(d,s),b:E=o(E,s)}},o=(e,t)=>Math.floor(Math.sqrt(e/(t/4))),i=(e,a,o,i,r)=>{e.width=a,e.height=o;const n=e.getContext("2d"),c=.5*a,s=n.createRadialGradient(c,o+110,o-100,c,o+110,o+100);t(s,i,r,void 0,8,.4),n.save(),n.translate(.5*-a,0),n.scale(2,1),n.fillStyle=s,n.fillRect(0,0,a,o),n.restore()},r="undefined"!=typeof navigator,n=r&&document.createElement("canvas"),c=r&&document.createElement("canvas"),s=r&&document.createElement("canvas");r&&(i(n,500,200,[40,40,40],.85),i(c,500,200,[196,78,71],1),i(s,500,200,[54,151,99],1));const l=t=>{const o=(e=>e.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:({root:e,props:t})=>{((e,t)=>{t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0)})(t.template,e.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}))(t),i=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},r=({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlayError.opacity=1};return t.utils.createView({name:"file-poster-wrapper",create:({root:a,props:i})=>{const r=(t=>t.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:({root:e,props:t})=>{e.ref.image=document.createElement("img"),e.element.appendChild(e.ref.image)},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:t,action:a})=>{const{id:o}=t,i=e.query("GET_ITEM",{id:t.id});if(!i)return;const r=i.getMetadata("poster");e.ref.image.src=r,e.dispatch("DID_FILE_POSTER_DRAW",{id:o})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:e,scaleY:e,opacity:{type:"tween",duration:750}}}}))(t);a.ref.image=a.appendChildView(a.createChildView(r,{id:i.id,scaleX:1.25,scaleY:1.25,opacity:0})),a.ref.overlayShadow=a.appendChildView(a.createChildView(o,{template:n,opacity:0})),a.ref.overlaySuccess=a.appendChildView(a.createChildView(o,{template:s,opacity:0})),a.ref.overlayError=a.appendChildView(a.createChildView(o,{template:c,opacity:0}))},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:t})=>{e.ref.overlayShadow.opacity=1},DID_FILE_POSTER_DRAW:({root:e,props:t})=>{const{image:a}=e.ref;a.scaleX=1,a.scaleY=1,a.opacity=1},DID_FILE_POSTER_CONTAINER_CREATE:({root:e,props:t})=>{const{id:o}=t,i=e.query("GET_ITEM",o);if(!i)return;const r=i.getMetadata("poster"),n=t=>{const r=e.query("GET_FILE_POSTER_CALCULATE_AVERAGE_IMAGE_COLOR")?a(t):null;i.setMetadata("color",r,!0),e.dispatch("DID_FILE_POSTER_LOAD",{id:o,data:t})};((e,t)=>{let a=new Image;a.onload=(()=>{const e=a.naturalWidth,o=a.naturalHeight;a=null,t(e,o)}),a.src=e})(r,(t,a)=>{e.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:o,width:t,height:a}),(e=>new Promise((t,a)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=(()=>{t(o)}),o.onerror=(e=>{a(e)}),o.src=e}))(r).then(n)})},DID_THROW_ITEM_LOAD_ERROR:r,DID_THROW_ITEM_PROCESSING_ERROR:r,DID_THROW_ITEM_INVALID:r,DID_COMPLETE_ITEM_PROCESSING:({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:i,DID_REVERT_ITEM_PROCESSING:i})})},d=e=>{const{addFilter:t,utils:a}=e,{Type:o,createRoute:i}=a,r=l(e);return t("CREATE_VIEW",e=>{const{is:t,view:a,query:o}=e;if(!t("file")||!o("GET_ALLOW_FILE_POSTER"))return;a.registerWriter(i({DID_LOAD_ITEM:({root:e,props:t,actions:i})=>{const{id:n}=t,c=o("GET_ITEM",n);c&&c.getMetadata("poster")&&!c.archived&&(e.ref.filePoster=a.appendChildView(a.createChildView(r,{id:n})),e.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:n}))},DID_FILE_POSTER_CALCULATE_SIZE:({root:e,props:t,action:a})=>{const o=e.rect.element.width*(a.height/a.width);e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:t.id,height:o})}}))}),{options:{allowFilePoster:[!0,o.BOOLEAN],filePosterCalculateAverageImageColor:[!1,o.BOOLEAN]}}};"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:d}));export default d;
