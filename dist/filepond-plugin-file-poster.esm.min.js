/*
 * FilePondPluginFilePoster 1.1.3
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */

/* eslint-disable */
const IMAGE_SCALE_SPRING_PROPS={type:"spring",stiffness:.5,damping:.45,mass:10},createPosterView=e=>e.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:({root:e,props:t})=>{e.ref.image=document.createElement("img"),e.element.appendChild(e.ref.image)},write:e.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:t,action:a})=>{const{id:r}=t,o=e.query("GET_ITEM",{id:t.id});if(!o)return;const i=o.getMetadata("poster");e.ref.image.src=i,e.dispatch("DID_FILE_POSTER_DRAW",{id:r})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:IMAGE_SCALE_SPRING_PROPS,scaleY:IMAGE_SCALE_SPRING_PROPS,opacity:{type:"tween",duration:750}}}}),applyTemplate=(e,t)=>{t.width=e.width,t.height=e.height;t.getContext("2d").drawImage(e,0,0)},createPosterOverlayView=e=>e.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:({root:e,props:t})=>{applyTemplate(t.template,e.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),getImageSize=(e,t)=>{let a=new Image;a.onload=(()=>{const e=a.naturalWidth,r=a.naturalHeight;a=null,t(e,r)}),a.src=e},easeInOutSine=e=>-.5*(Math.cos(Math.PI*e)-1),addGradientSteps=(e,t,a=1,r=easeInOutSine,o=10,i=0)=>{const l=1-i,s=t.join(",");for(let t=0;t<=o;t++){const c=t/o,n=i+l*c;e.addColorStop(n,`rgba(${s}, ${r(c)*a})`)}},MAX_WIDTH=10,MAX_HEIGHT=10,calculateAverageColor=e=>{const t=Math.min(10/e.width,10/e.height),a=document.createElement("canvas"),r=a.getContext("2d"),o=a.width=Math.ceil(e.width*t),i=a.height=Math.ceil(e.height*t);r.drawImage(e,0,0,o,i);let l=null;try{l=r.getImageData(0,0,o,i).data}catch(e){return null}const s=l.length;let c=0,n=0,d=0,p=0;for(;p<s;p+=4)c+=l[p]*l[p],n+=l[p+1]*l[p+1],d+=l[p+2]*l[p+2];return c=averageColor(c,s),n=averageColor(n,s),d=averageColor(d,s),{r:c,g:n,b:d}},averageColor=(e,t)=>Math.floor(Math.sqrt(e/(t/4))),drawTemplate=(e,t,a,r,o)=>{e.width=t,e.height=a;const i=e.getContext("2d"),l=.5*t,s=i.createRadialGradient(l,a+110,a-100,l,a+110,a+100);addGradientSteps(s,r,o,void 0,8,.4),i.save(),i.translate(.5*-t,0),i.scale(2,1),i.fillStyle=s,i.fillRect(0,0,t,a),i.restore()},hasNavigator="undefined"!=typeof navigator,width=500,height=200,overlayTemplateShadow=hasNavigator&&document.createElement("canvas"),overlayTemplateError=hasNavigator&&document.createElement("canvas"),overlayTemplateSuccess=hasNavigator&&document.createElement("canvas");hasNavigator&&(drawTemplate(overlayTemplateShadow,500,200,[40,40,40],.85),drawTemplate(overlayTemplateError,500,200,[196,78,71],1),drawTemplate(overlayTemplateSuccess,500,200,[54,151,99],1));const loadImage=e=>new Promise((t,a)=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=(()=>{t(r)}),r.onerror=(e=>{a(e)}),r.src=e}),createPosterWrapperView=e=>{const t=createPosterOverlayView(e),a=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},r=({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlayError.opacity=1};return e.utils.createView({name:"file-poster-wrapper",create:({root:a,props:r,dispatch:o})=>{const i=createPosterView(e);a.ref.image=a.appendChildView(a.createChildView(i,{id:r.id,scaleX:1.25,scaleY:1.25,opacity:0})),a.ref.overlayShadow=a.appendChildView(a.createChildView(t,{template:overlayTemplateShadow,opacity:0})),a.ref.overlaySuccess=a.appendChildView(a.createChildView(t,{template:overlayTemplateSuccess,opacity:0})),a.ref.overlayError=a.appendChildView(a.createChildView(t,{template:overlayTemplateError,opacity:0}))},write:e.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:t})=>{e.ref.overlayShadow.opacity=1},DID_FILE_POSTER_DRAW:({root:e,props:t})=>{const{image:a}=e.ref;a.scaleX=1,a.scaleY=1,a.opacity=1},DID_FILE_POSTER_CONTAINER_CREATE:({root:e,props:t,action:a})=>{const{id:r}=t,o=e.query("GET_ITEM",r);if(!o)return;const i=o.getMetadata("poster");getImageSize(i,(t,a)=>{e.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:r,width:t,height:a}),loadImage(i).then(t=>{const a=e.query("GET_FILE_POSTER_CALCULATE_AVERAGE_IMAGE_COLOR")?calculateAverageColor(t):null;o.setMetadata("color",a,!0),e.dispatch("DID_FILE_POSTER_LOAD",{id:r,data:t})})})},DID_THROW_ITEM_LOAD_ERROR:r,DID_THROW_ITEM_PROCESSING_ERROR:r,DID_THROW_ITEM_INVALID:r,DID_COMPLETE_ITEM_PROCESSING:({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:a,DID_REVERT_ITEM_PROCESSING:a})})};var plugin$1=e=>{const{addFilter:t,utils:a}=e,{Type:r,createRoute:o}=a,i=createPosterWrapperView(e);return t("CREATE_VIEW",e=>{const{is:t,view:a,query:r}=e;if(!t("file")||!r("GET_ALLOW_FILE_POSTER"))return;a.registerWriter(o({DID_LOAD_ITEM:({root:e,props:t,actions:o})=>{const{id:l}=t,s=r("GET_ITEM",l);s&&s.getMetadata("poster")&&!s.archived&&(e.ref.imagePreview=a.appendChildView(a.createChildView(i,{id:l})),e.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:l}))},DID_FILE_POSTER_CALCULATE_SIZE:({root:e,props:t,action:a})=>{const r=e.rect.element.width*(a.height/a.width);e.ref.imagePreview.element.style.cssText=`height:${Math.round(r)}px`}}))}),{options:{allowFilePoster:[!0,r.BOOLEAN],filePosterCalculateAverageImageColor:[!1,r.BOOLEAN]}}};const isBrowser="undefined"!=typeof window&&void 0!==window.document;isBrowser&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:plugin$1}));export default plugin$1;