/*
 * FilePondPluginFilePoster 1.0.0
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FilePondPluginFilePoster=t()}(this,function(){"use strict";var e={type:"spring",stiffness:.5,damping:.45,mass:10},t=function(t){return t.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:function(e){var t=e.root;t.ref.image=document.createElement("img"),t.element.appendChild(t.ref.image)},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:function(e){var t=e.root,i=e.props,a=i.id,r=t.query("GET_ITEM",{id:i.id}),o=r.getMetadata("poster");t.ref.image.src=o,t.dispatch("DID_FILE_POSTER_DRAW",{id:a})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:e,scaleY:e,opacity:{type:"tween",duration:750}}}})},i=function(e,t){t.width=e.width,t.height=e.height;var i=t.getContext("2d");i.drawImage(e,0,0)},a=function(e){return e.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:function(e){var t=e.root,a=e.props;i(a.template,t.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}})},r=function(e,t){var i=new Image;i.onload=function(){var e=i.naturalWidth,a=i.naturalHeight;i=null,t(e,a)},i.src=e},o=function(e){return-.5*(Math.cos(Math.PI*e)-1)},n=function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=1-n,d=t.join(","),l=0;l<=r;l++){var s=l/r,p=n+c*s;e.addColorStop(p,"rgba("+d+", "+a(s)*i+")")}},c=function(e,t,i,a,r){e.width=t,e.height=i;var o=e.getContext("2d"),c=.5*t,d=o.createRadialGradient(c,i+110,i-100,c,i+110,i+100);n(d,a,r,void 0,8,.4),o.save(),o.translate(.5*-t,0),o.scale(2,1),o.fillStyle=d,o.fillRect(0,0,t,i),o.restore()},d="undefined"!=typeof navigator,l=500,s=200,p=d&&document.createElement("canvas"),u=d&&document.createElement("canvas"),E=d&&document.createElement("canvas");d&&(c(p,l,s,[40,40,40],.85),c(u,l,s,[196,78,71],1),c(E,l,s,[54,151,99],1));var f=function(e){var i=a(e),o=function(t){var i=t.root,a=t.props,o=e.utils,n=o.loadImage,c=a.id,d=i.query("GET_ITEM",c),l=d.getMetadata("poster"),s=function(e){i.dispatch("DID_FILE_POSTER_LOAD",{id:c,data:e})};r(l,function(e,t){i.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:c,width:e,height:t}),n(l).then(s)})},n=function(e){var t=e.root;t.ref.overlayShadow.opacity=1},c=function(e){var t=e.root,i=t.ref.image;i.scaleX=1,i.scaleY=1,i.opacity=1},d=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},l=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1},s=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},f=function(a){var r=a.root,o=a.props,n=t(e);r.ref.image=r.appendChildView(r.createChildView(n,{id:o.id,scaleX:1.25,scaleY:1.25,opacity:0})),r.ref.overlayShadow=r.appendChildView(r.createChildView(i,{template:p,opacity:0})),r.ref.overlaySuccess=r.appendChildView(r.createChildView(i,{template:E,opacity:0})),r.ref.overlayError=r.appendChildView(r.createChildView(i,{template:u,opacity:0}))};return e.utils.createView({name:"file-poster-wrapper",create:f,write:e.utils.createRoute({DID_FILE_POSTER_LOAD:n,DID_FILE_POSTER_DRAW:c,DID_FILE_POSTER_CONTAINER_CREATE:o,DID_THROW_ITEM_LOAD_ERROR:l,DID_THROW_ITEM_PROCESSING_ERROR:l,DID_THROW_ITEM_INVALID:l,DID_COMPLETE_ITEM_PROCESSING:s,DID_START_ITEM_PROCESSING:d,DID_REVERT_ITEM_PROCESSING:d})})},_=function(e){var t=e.addFilter,i=e.utils,a=i.Type,r=i.createRoute,o=f(e);return t("CREATE_VIEW",function(e){var t=e.is,i=e.view,a=e.query;if(t("file")&&a("GET_ALLOW_FILE_POSTER")){var n=function(e){var t=e.root,r=e.props,n=r.id,c=a("GET_ITEM",n);c&&c.getMetadata("poster")&&(t.ref.imagePreview=i.appendChildView(i.createChildView(o,{id:n})),t.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:n}))},c=function(e){var t=e.root,i=e.props,a=e.action,r=(t.query("GET_ITEM",{id:i.id}),t.rect.element.width*(a.height/a.width));t.ref.imagePreview.element.style.cssText="height:"+Math.round(r)+"px"};i.registerWriter(r({DID_LOAD_ITEM:n,DID_FILE_POSTER_CALCULATE_SIZE:c}))}}),{options:{allowFilePoster:[!0,a.BOOLEAN]}}};return"undefined"!=typeof navigator&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:_})),_});